name: autosquash
on:
  check_run:
    types:
      # Check runs completing successfully can unblock the
      # corresponding pull requests and make them mergeable.
      - completed
  pull_request:
    types:
      # A closed pull request makes the checks on the other
      # pull request on the same base outdated.
      - closed
      # Adding the autosquash label to a pull request can
      # trigger an update or a merge.
      - labeled
  pull_request_review:
    types:
      # Review approvals can unblock the pull request and
      # make it mergeable.
      - submitted
  # Success statuses can unblock the corresponding
  # pull requests and make them mergeable.
  status: {}

jobs:
  autosquash:
    name: Autosquash
    runs-on: ubuntu-latest
    steps:
      - name: automerge
        uses: "pascalgn/automerge-action@4775c532c615e0491d53bc42c0893840ae7cc07a"
        env:
          GITHUB_TOKEN: "${{ secrets.WORKFLOW_TOKEN }}"
          MERGE_LABELS: "autosquash,!work in progress"
          MERGE_REMOVE_LABELS: "autosquash"
          MERGE_METHOD: "squash"
          MERGE_COMMIT_MESSAGE: "pull-request-title-and-description"
